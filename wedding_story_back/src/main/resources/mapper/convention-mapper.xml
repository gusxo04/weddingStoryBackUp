<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.co.iei.convention.model.dao.ConventionDao">

    <select id="getTime" resultType="convention">
        select * from 
            (select rownum as rnum, c1.* from 
                (select * from convention order by 1 desc)c1) 
        where rnum = 1
    </select>
    <!-- 1 or 4 -->

    <select id="selectConventionSeat" resultType="conventionSeat">
        select * from convention_seat where
        seat_code like 
        <choose>
            <when test="i == 0">
                'A%'
            </when>
            <when test="i == 1">
                'B%'
            </when>
            <when test="i == 2">
                'C%'
            </when>
        </choose>
        order by 1
    </select>

    <insert id="insertConvention">
        insert into convention values(convention_seq.nextval,#{conventionTitle},#{conventionContent},#{conventionImg},#{conventionStart},#{conventionEnd},#{conventionTime},sysdate,#{conventionPrice},#{conventionLimit},#{imgStyle})
    </insert>

    <insert id="insertConventionMember">
        insert into convention_member values(convention_member_seq.nextval, #{conventionNo}, #{memberNo}, #{ticketCode}, #{memberEmail})
        <selectKey resultType="int" keyProperty="ticketNo" order="AFTER">
            select max(ticket_no) from convention_member
        </selectKey>
    </insert>

    <insert id="insertMemberPay">
        insert into member_pay values(member_pay_seq.nextval, #{memberNo}, null, #{ticketNo}, sysdate, #{progressDate}, #{progressTime}, #{payPrice}, 0, #{merchantUid})
    </insert>

    <select id="selectOneConvention" resultType="convention">
        select * from convention where convention_no = #{conventionNo}
    </select>

    <update id="updateConvention">
        update convention set convention_title = #{conventionTitle}, convention_content = #{conventionContent}, convention_img = #{conventionImg}, convention_time = #{conventionTime}, img_style = #{imgStyle} where convention_no = #{conventionNo}
    </update>

</mapper>
